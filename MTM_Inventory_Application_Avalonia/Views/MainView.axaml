<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:MTM_Inventory_Application_Avalonia.ViewModels"
             xmlns:dialogs="clr-namespace:MTM_Inventory_Application_Avalonia.Views.Dialogs"
             xmlns:conv="clr-namespace:MTM_Inventory_Application_Avalonia.Converters"
             xmlns:ia="clr-namespace:Projektanker.Icons.Avalonia;assembly=Projektanker.Icons.Avalonia"
             mc:Ignorable="d" d:DesignWidth="960" d:DesignHeight="600"
             x:Class="MTM_Inventory_Application_Avalonia.Views.MainView"
             x:DataType="vm:MainViewModel">
	<Design.DataContext>
		<vm:MainViewModel />
	</Design.DataContext>

	<Grid>
		<!-- Main layout (side panel + content) -->
		<Grid x:Name="MainLayoutRoot"
			  IsVisible="{Binding IsLoginVisible, Converter={x:Static conv:InverseBooleanConverter.Instance}}"
			  Margin="20"
			  RowDefinitions="Auto,Auto,Auto"
			  ColumnDefinitions="*"
			  VerticalAlignment="Center">
			<!-- Header / Greeting -->
			<Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Center">
				<Viewbox Grid.Column="0" Width="32" Height="32" Stretch="Uniform">
					<ia:Icon Value="mdi:view-dashboard-outline"/>
				</Viewbox>
				<TextBlock Grid.Column="1" Margin="10,0,0,0" Text="{Binding Greeting}" FontSize="24" FontWeight="SemiBold" VerticalAlignment="Center"/>
				<StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="16" HorizontalAlignment="Right" VerticalAlignment="Center">
					<ia:Icon Value="mdi:account" Width="18" Height="18"/>
					<TextBlock Text="User:" Opacity="0.7" VerticalAlignment="Center"/>
					<TextBlock Text="{Binding SessionUser}" VerticalAlignment="Center"/>
					<TextBlock Text="Site:" Opacity="0.7" Margin="12,0,0,0" VerticalAlignment="Center"/>
					<TextBlock Text="{Binding SiteId}" VerticalAlignment="Center"/>
					<TextBlock Text="Warehouse:" Opacity="0.7" Margin="12,0,0,0" VerticalAlignment="Center"/>
					<TextBlock Text="{Binding WarehouseId}" VerticalAlignment="Center"/>
				</StackPanel>
			</Grid>

			<!-- Main area: Left collapsible side panel + Right content host -->
			<Grid Grid.Row="1" ColumnDefinitions="Auto,*" Margin="0,12,0,12">
				<!-- Side panel -->
				<Border Background="{DynamicResource ThemeBackgroundBrush}" BorderBrush="{DynamicResource ThemeBorderBrush}" BorderThickness="0,1,1,1">
					<StackPanel Width="240" IsVisible="{Binding IsMenuOpen}" Margin="0,12,12,12" Spacing="10">
						<!-- New: test Exception dialog -->
						<Button Command="{Binding MainView_Button_TestExceptionDialogCommand}"
								ToolTip.Tip="Open Exception Dialog (test)">
							<StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
								<ia:Icon Value="mdi:alert-circle-outline" Width="18" Height="18"/>
								<TextBlock Text="Test Exception Dialog" VerticalAlignment="Center"/>
							</StackPanel>
						</Button>

						<Button Command="{Binding MainView_Button_OpenWorkOrderTransactionCommand}"
								IsEnabled="{Binding CanOpenWorkOrderTransaction}"
								ToolTip.Tip="Open Work Order Transaction (Alt+W)">
							<StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
								<ia:Icon Value="mdi:clipboard-list-outline" Width="18" Height="18"/>
								<TextBlock Text="Work Order Transaction" VerticalAlignment="Center"/>
							</StackPanel>
						</Button>
						<Button Command="{Binding MainView_Button_OpenInventoryTransferCommand}"
								IsEnabled="{Binding CanOpenInventoryTransfer}"
								ToolTip.Tip="Open Inventory Transfer (Alt+I)">
							<StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
								<ia:Icon Value="mdi:swap-horizontal" Width="18" Height="18"/>
								<TextBlock Text="Inventory Transfer" VerticalAlignment="Center"/>
							</StackPanel>
						</Button>
					</StackPanel>
				</Border>

				<!-- Right: content host -->
				<Grid Grid.Column="1" Margin="12,12,0,12">
					<ContentControl Content="{Binding CurrentView}"/>
				</Grid>
			</Grid>

			<!-- Footer: settings above toggle, same width -->
			<Grid Grid.Row="2" ColumnDefinitions="Auto,*" VerticalAlignment="Center">
				<StackPanel Grid.Column="0" Orientation="Vertical" Spacing="8">
					<Button Command="{Binding MainView_Button_OpenSettingsCommand}"
							Width="{Binding #ToggleMenuButton.Bounds.Width}"
							ToolTip.Tip="Open Settings">
						<StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
							<ia:Icon Value="mdi:cog-outline" Width="16" Height="16"/>
							<TextBlock Text="Settings" VerticalAlignment="Center"/>
						</StackPanel>
					</Button>

					<ToggleButton x:Name="ToggleMenuButton" IsChecked="{Binding IsMenuOpen}">
						<StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
							<ia:Icon Value="mdi:menu" Width="16" Height="16"/>
							<TextBlock Text="Toggle Menu" VerticalAlignment="Center"/>
						</StackPanel>
					</ToggleButton>
				</StackPanel>

				<StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8">
					<Button Command="{Binding MainView_Button_LogoutCommand}" ToolTip.Tip="Logout (Alt+L)">
						<StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
							<ia:Icon Value="mdi:logout" Width="16" Height="16"/>
							<TextBlock Text="Logout" VerticalAlignment="Center"/>
						</StackPanel>
					</Button>
				</StackPanel>
			</Grid>
		</Grid>

		<!-- Full overlay login screen -->
		<Border Background="#FFFFFFFF" IsVisible="{Binding IsLoginVisible}">
			<Grid>
				<dialogs:LoginView DataContext="{Binding LoginVm}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
			</Grid>
		</Border>
	</Grid>
</UserControl>
