<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:MTM_Inventory_Application_Avalonia.ViewModels.Dialogs"
             xmlns:ia="clr-namespace:Projektanker.Icons.Avalonia;assembly=Projektanker.Icons.Avalonia"
             mc:Ignorable="d"
             x:Class="MTM_Inventory_Application_Avalonia.Views.Dialogs.IncompletePartDialog"
             x:DataType="vm:IncompletePartDialogViewModel">
  <Design.DataContext>
    <!-- Seeded with a value close to the screenshot so the grid is filled -->
    <vm:IncompletePartDialogViewModel SearchText="21-28841-" />
  </Design.DataContext>

  <!-- Keyboard shortcuts: Enter selects, Esc cancels -->
  <UserControl.KeyBindings>
    <KeyBinding Gesture="Enter" Command="{Binding IncompletePartDialog_Button_SelectCommand}"/>
    <KeyBinding Gesture="Escape" Command="{Binding IncompletePartDialog_Button_CancelCommand}"/>
  </UserControl.KeyBindings>

  <!-- Layout: toolbar header, results grid, footer actions -->
  <Grid Margin="10" RowDefinitions="Auto,*,Auto">
    <!-- Toolbar/header row -->
    <Border Grid.Row="0" Padding="8" BorderBrush="#33000000" BorderThickness="0,0,0,1">
      <Grid ColumnDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,*,Auto,Auto,Auto">
        <!-- App-like toolbar icons (visual only) -->
        <TextBlock Grid.Column="0" Text="Parts" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,12,0"/>
        <Button Grid.Column="1" Classes="ToolButton" Padding="4" ToolTip.Tip="Accept">
          <ia:Icon Value="mdi:check-circle-outline" Width="18" Height="18"/>
        </Button>
        <Button Grid.Column="2" Classes="ToolButton" Padding="4" ToolTip.Tip="Cancel">
          <ia:Icon Value="mdi:close-circle-outline" Width="18" Height="18"/>
        </Button>
        <Button Grid.Column="3" Classes="ToolButton" Padding="4" ToolTip.Tip="Refresh">
          <ia:Icon Value="mdi:refresh" Width="18" Height="18"/>
        </Button>
        <Button Grid.Column="4" Classes="ToolButton" Padding="4" ToolTip.Tip="Search">
          <ia:Icon Value="mdi:magnify" Width="18" Height="18"/>
        </Button>
        <Button Grid.Column="5" Classes="ToolButton" Padding="4" ToolTip.Tip="Filter">
          <ia:Icon Value="mdi:filter-variant" Width="18" Height="18"/>
        </Button>
        <Button Grid.Column="6" Classes="ToolButton" Padding="4" ToolTip.Tip="Clear Filter">
          <ia:Icon Value="mdi:filter-off-outline" Width="18" Height="18"/>
        </Button>

        <!-- Search + filters aligned right like the screenshot -->
        <TextBox Grid.Column="7" Watermark="Part ID starts with..." Text="{Binding SearchText}" MinWidth="260" Margin="10,0"/>
        <CheckBox Grid.Column="8" Content="Active only" IsChecked="{Binding Filters_ActiveOnly}" VerticalAlignment="Center" Margin="6,0"/>
        <CheckBox Grid.Column="9" Content="Search in description" IsChecked="{Binding Filters_SearchInDescription}" VerticalAlignment="Center" Margin="6,0"/>
        <StackPanel Grid.Column="10" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center" Margin="10,0,0,0">
          <TextBlock Text="Match:" VerticalAlignment="Center"/>
          <ComboBox SelectedIndex="{Binding Filters_ModeIndex}" MinWidth="150">
            <ComboBoxItem Content="Contains (%seed%)"/>
            <ComboBoxItem Content="Starts with (seed%)"/>
          </ComboBox>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Results grid -->
    <Expander Grid.Row="1" IsExpanded="True" HorizontalAlignment="Stretch">
      <Expander.Header>
        <StackPanel Orientation="Horizontal" Spacing="8">
          <ia:Icon Value="mdi:view-list" Width="18" Height="18"/>
          <TextBlock Text="Results" VerticalAlignment="Center"/>
          <Border Background="{DynamicResource ThemeAccentBrush}" CornerRadius="10" Padding="6,2" VerticalAlignment="Center" Margin="6,0,0,0">
            <TextBlock Foreground="White" FontWeight="SemiBold" Text="{Binding Results.Count, FallbackValue=0}" VerticalAlignment="Center"/>
          </Border>
        </StackPanel>
      </Expander.Header>

      <Border Margin="0,6,0,6" Padding="6" BorderBrush="{DynamicResource ThemeForegroundLowBrush}" BorderThickness="1" CornerRadius="6">
        <DataGrid
          ItemsSource="{Binding Results}"
          AutoGenerateColumns="False"
          IsReadOnly="True"
          GridLinesVisibility="All"
          HeadersVisibility="All"
          SelectionMode="Single"
          SelectedItem="{Binding SelectedPart}"
          ColumnWidth="Auto"
          DoubleTapped="OnResultsDoubleTapped">
          <DataGrid.Columns>
            <DataGridTextColumn Header="Part ID" Binding="{Binding PartId}" Width="Auto"/>
            <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="Auto"/>
            <DataGridTextColumn Header="Stock UM" Binding="{Binding StockUm}" Width="Auto"/>
            <DataGridCheckBoxColumn Header="Fab" Binding="{Binding Fab}" Width="Auto"/>
            <DataGridCheckBoxColumn Header="Pur" Binding="{Binding Pur}" Width="Auto"/>
            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="Auto"/>
          </DataGrid.Columns>
        </DataGrid>
      </Border>
    </Expander>

    <!-- Footer actions -->
    <Grid Grid.Row="2" ColumnDefinitions="*,Auto,Auto" Margin="0,0,0,4">
      <TextBlock Grid.Column="0" Text="{Binding Results.Count, StringFormat='{}{0} results'}" Opacity="0.7" VerticalAlignment="Center"/>
      <Button Grid.Column="1" IsDefault="True" Command="{Binding IncompletePartDialog_Button_SelectCommand}" IsEnabled="{Binding CanSelect}" Margin="0,0,10,0">
        <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
          <ia:Icon Value="mdi:check" Width="16" Height="16"/>
          <TextBlock Text="Select" VerticalAlignment="Center"/>
        </StackPanel>
      </Button>
      <Button Grid.Column="2" IsCancel="True" Command="{Binding IncompletePartDialog_Button_CancelCommand}">
        <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
          <ia:Icon Value="mdi:close" Width="16" Height="16"/>
          <TextBlock Text="Cancel" VerticalAlignment="Center"/>
        </StackPanel>
      </Button>
    </Grid>
  </Grid>
</UserControl>
