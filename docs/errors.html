<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Exception Handling â€” MTM Inventory Application</title>
  <link rel="stylesheet" href="../UIX Template/assets/css/fontawesome-all.min.css" />
  <link rel="stylesheet" href="../UIX Template/assets/css/main.css" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body class="is-preload with-sidebar">
  <aside class="toc-sidebar">
    <a class="logo" href="index.html"><img src="./Images/MTM_Logo.png" alt="MTM Logo" style="height:initial;width:initial;" /> <span>MTM Inventory App</span></a>
    <h3>Contents</h3>
    <nav>
      <ul>
        <li><a href="index.html">Overview</a></li>
        <li><a href="platforms.html">Platforms</a></li>
        <li><a href="visual-db-interactions.html">VISUAL DB Interactions</a></li>
        <li><a href="rules.html">Global Rules and Platform</a></li>
        <li><a href="login.html">Login</a></li>
        <li><a href="mainview.html">Main View</a></li>
        <li><a href="inventory-transfer.html">Inventory Transfer</a></li>
        <li><a href="workorder.html">Work Order Transactions</a></li>
        <li><a href="dialogs.html">Supporting Dialogs</a></li>
        <li><a href="errors.html">Exception Handling</a></li>
        <li><a href="settings.html">Settings</a></li>
        <li><a href="mamp.html">App Database (MAMP)</a></li>
        <li><a href="config.html">Configuration & Run</a></li>
        <li><a href="advanced.html">Advanced</a></li>
        <li><a href="future-updates.html">Future Updates</a></li>
        <li><a href="links.html">Source Planning Docs</a></li>
      </ul>
    </nav>
  </aside>
  <div id="page-wrap">
    <article id="top" class="wrapper style1"><div class="container"><header><h1>Centralized Exception Handling</h1></header></div></article>
    <main class="container">
      <section class="panel" id="errors">
        <h2>Purpose and Overview</h2>
        <p>The centralized exception handling system routes all application errors through a single service for consistent user experience and comprehensive error management. This system provides user-friendly error messages, detailed technical information, and planned logging capabilities for analysis and troubleshooting.</p>

        <h2>How Exception Handling Works</h2>
        <h3>Error Flow Process</h3>
        <ol>
          <li>Any method in the application catches exceptions in try/catch blocks</li>
          <li>Exceptions are passed to <code>IExceptionHandler.Handle(ex, context)</code></li>
          <li>The exception handler creates an ExceptionDialogViewModel with error details</li>
          <li>A modal Exception Dialog displays to the user</li>
          <li>User can view details, copy information, or dismiss the dialog</li>
          <li>Technical details are logged for debugging purposes</li>
        </ol>

        <h3>Current Implementation</h3>
        <ul>
          <li><strong>Service</strong>: <code>ExceptionHandler</code> class in Services.cs</li>
          <li><strong>Dialog</strong>: Modal window with ExceptionDialog view</li>
          <li><strong>Context</strong>: Method name and operation context included</li>
          <li><strong>Fallback</strong>: Debug.WriteLine output if dialog creation fails</li>
        </ul>

        <h2>Exception Dialog Features</h2>
        <h3>User Interface Elements</h3>
        <table>
          <thead>
            <tr>
              <th>Element</th>
              <th>Description</th>
              <th>Purpose</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Title</td>
              <td>Context of where the error occurred</td>
              <td>Help users understand what operation failed</td>
            </tr>
            <tr>
              <td>Message</td>
              <td>User-friendly error description</td>
              <td>Explain what went wrong in understandable terms</td>
            </tr>
            <tr>
              <td>Details Expander</td>
              <td>Technical stack trace and exception details</td>
              <td>Provide information for developers and support</td>
            </tr>
            <tr>
              <td>OK Button</td>
              <td>Dismiss the dialog</td>
              <td>Allow user to continue after acknowledging error</td>
            </tr>
          </tbody>
        </table>

        <h3>Keyboard Shortcuts</h3>
        <ul>
          <li><span class="kbd">Enter</span>: Dismiss dialog (same as OK button)</li>
          <li><span class="kbd">Esc</span>: Cancel/dismiss dialog</li>
          <li><span class="kbd">Ctrl + C</span>: Copy error details to clipboard (planned)</li>
          <li><span class="kbd">F1</span>: Open context-sensitive help (planned)</li>
        </ul>

        <h2>Error Categories</h2>
        <h3>Configuration and Setup Errors</h3>
        <ul>
          <li><strong>Missing Database.config</strong>: Configuration file not found or inaccessible</li>
          <li><strong>Invalid instance registration</strong>: VISUAL instance not properly configured</li>
          <li><strong>DLL reference issues</strong>: Required VISUAL API DLLs missing or incompatible</li>
          <li><strong>Architecture mismatch</strong>: x86/x64 compatibility issues with VISUAL toolkit</li>
        </ul>

        <h3>Connection and Authentication Errors</h3>
        <ul>
          <li><strong>OpenLocal failure</strong>: Cannot connect to VISUAL database with provided credentials</li>
          <li><strong>OpenLocalSSO errors</strong>: Single sign-on authentication failures</li>
          <li><strong>User mapping issues</strong>: VISUAL user not found or not mapped properly</li>
          <li><strong>Network connectivity</strong>: Database server unreachable</li>
        </ul>

        <h3>Business Validation Errors</h3>
        <ul>
          <li><strong>Closed Work Order</strong>: Attempting operations on closed/completed work orders</li>
          <li><strong>Insufficient Inventory</strong>: Not enough available quantity for requested operation</li>
          <li><strong>Over Receipt</strong>: Receiving more than work order allows</li>
          <li><strong>Invalid Part/Location</strong>: Referenced items don't exist or are inactive</li>
          <li><strong>TRACE violations</strong>: Lot/serial requirements not met</li>
        </ul>

        <h3>API and Service Execution Errors</h3>
        <ul>
          <li><strong>GeneralQuery misuse</strong>: Query not prepared or parameters missing</li>
          <li><strong>InventoryTransaction failures</strong>: Required fields missing or invalid</li>
          <li><strong>Service timeout</strong>: VISUAL operations taking too long</li>
          <li><strong>License management</strong>: Issues acquiring or releasing VISUAL licenses</li>
        </ul>

        <h2>Error Message Guidelines</h2>
        <h3>User-Friendly Messages</h3>
        <ul>
          <li>Avoid technical jargon in main message text</li>
          <li>Explain what the user was trying to do</li>
          <li>Suggest specific actions to resolve the issue</li>
          <li>Include relevant context (work order number, part ID, etc.)</li>
        </ul>

        <h3>Technical Details</h3>
        <ul>
          <li>Full exception stack trace in details section</li>
          <li>Method name and operation context</li>
          <li>Timestamp and user context</li>
          <li>Relevant parameter values (excluding sensitive data)</li>
        </ul>

        <h2>Planned Enhancements</h2>
        <h3>Error Normalization</h3>
        <ul>
          <li><strong>Category Classification</strong>: Group errors by type (Connection, Business, Validation)</li>
          <li><strong>Severity Levels</strong>: Critical, High, Medium, Low severity ratings</li>
          <li><strong>Suggested Actions</strong>: Specific recommendations for resolution</li>
          <li><strong>Help Integration</strong>: Links to relevant documentation</li>
        </ul>

        <h3>Logging and Analysis</h3>
        <ul>
          <li><strong>Database Logging</strong>: Store exceptions in app database for analysis</li>
          <li><strong>Business Exception Tracking</strong>: Special handling for closed WO, over-receipts</li>
          <li><strong>Audit Trail</strong>: Complete context including user and operation details</li>
          <li><strong>Reporting</strong>: Dashboard for exception trends and patterns</li>
        </ul>

        <h3>User Experience Improvements</h3>
        <ul>
          <li><strong>Toast Notifications</strong>: Non-blocking notifications for low-severity issues</li>
          <li><strong>Copy to Clipboard</strong>: Easy copying of error details for support</li>
          <li><strong>Retry Mechanisms</strong>: Automatic retry for transient failures</li>
          <li><strong>Context-Sensitive Help</strong>: F1 help based on error type</li>
        </ul>

        <h2>Error Prevention Strategies</h2>
        <h3>Input Validation</h3>
        <ul>
          <li>Field-level validation before submission</li>
          <li>Real-time format checking for IDs and quantities</li>
          <li>Availability checking before posting transactions</li>
          <li>Work order status validation before operations</li>
        </ul>

        <h3>Connection Management</h3>
        <ul>
          <li>Connection testing on application startup</li>
          <li>Automatic reconnection for lost connections</li>
          <li>Proper license lifecycle management</li>
          <li>Timeout handling for long-running operations</li>
        </ul>

        <h2>Technical Implementation</h2>
        <h3>Key Components</h3>
        <ul>
          <li><strong>Interface</strong>: <code>IExceptionHandler</code></li>
          <li><strong>Implementation</strong>: <code>ExceptionHandler</code> class</li>
          <li><strong>Dialog View</strong>: <code>Views/Dialogs/ExceptionDialog.axaml</code></li>
          <li><strong>ViewModel</strong>: <code>ViewModels/Dialogs/ExceptionDialogViewModel.cs</code></li>
        </ul>

        <h3>Usage Pattern</h3>
        <pre><code>try
{
    // Operation code here
}
catch (Exception ex)
{
    _exceptionHandler.Handle(ex, nameof(MethodName));
}</code></pre>

        <h2>Troubleshooting Common Issues</h2>
        <h3>Exception Dialog Not Appearing</h3>
        <ul>
          <li>Check for fallback debug output in development console</li>
          <li>Verify MainWindow is properly initialized</li>
          <li>Ensure UI thread access for dialog creation</li>
        </ul>

        <h3>Repeated Exception Dialogs</h3>
        <ul>
          <li>Check for exception handling within exception handlers</li>
          <li>Verify proper disposal of resources</li>
          <li>Review error propagation through call stack</li>
        </ul>

        <h3>Missing Error Context</h3>
        <ul>
          <li>Ensure meaningful context strings in Handle() calls</li>
          <li>Include relevant operation parameters</li>
          <li>Verify exception wrapping preserves inner exceptions</li>
        </ul>

        <h2>References</h2>
        <ul>
          <li><a href="login.html">Login</a> - Authentication error handling</li>
          <li><a href="inventory-transfer.html">Inventory Transfer</a> - Transfer-specific errors</li>
          <li><a href="workorder.html">Work Order Transactions</a> - Work order error scenarios</li>
          <li><a href="mamp.html">App Database</a> - Exception logging database schema</li>
          <li><a href="config.html">Configuration</a> - Setup and configuration error resolution</li>
        </ul>
      </section>
    </main>
    <article class="wrapper style4"><div class="container medium"><footer><ul id="copyright"><li>&copy; MTM Inventory Application.</li><li>Design base: HTML5 UP Template</li></ul></footer></div></article>
  </div>
  <script src="../UIX Template/assets/js/jquery.min.js"></script>
  <script src="../UIX Template/assets/js/jquery.scrolly.min.js"></script>
  <script src="../UIX Template/assets/js/browser.min.js"></script>
  <script src="../UIX Template/assets/js/breakpoints.min.js"></script>
  <script src="../UIX Template/assets/js/util.js"></script>
  <script src="../UIX Template/assets/js/main.js"></script>
  <script>(function(){var p=location.pathname.split('/').pop()||'errors.html';document.querySelectorAll('.toc-sidebar nav a').forEach(function(a){var t=(a.getAttribute('href')||'').split('/').pop();if(t===p)a.classList.add('active');});})();</script>
</body>
</html>